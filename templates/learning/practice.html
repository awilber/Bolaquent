{% extends "base.html" %}

{% block title %}Practice - Bolaquent{% endblock %}

{% block body_class %}hero-page hero-practice{% endblock %}


{% block content %}
<div class="hero-content-wrapper">
    <div style="position: relative; z-index: 2; padding: 2rem; width: 100%; max-width: 1200px; margin: 0 auto;">
        <!-- Age-Appropriate Header with Contrast Panel -->
        <div style="background: rgba(0, 0, 0, 0.75); padding: 2rem; border-radius: 16px; margin-bottom: 2rem; backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.1);">
        {% if user.tier_id <= 2 %}
            <div class="playful-header" style="color: white; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); background: none; padding: 0; border: none;">
                <h2>üéØ Let's Practice Together!</h2>
                <div class="mascot">üåü</div>
                <p>Time to practice your amazing words!</p>
            </div>
        {% elif user.tier_id <= 4 %}
            <h2 style="color: white; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); margin: 0 0 1rem 0;">üéØ Practice Session</h2>
            <p style="color: white; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); margin: 0;">Ready to test your vocabulary skills?</p>
        {% else %}
            <h2 style="color: white; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); margin: 0 0 1rem 0;">üìù Vocabulary Practice</h2>
            <p style="color: white; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); margin: 0;">Focused training session for vocabulary mastery</p>
        {% endif %}
        </div>

<div class="practice-container">
    {% if words %}
        <div class="practice-stats">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{{ words|length }}</div>
                    <div class="stat-label">Words Available</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ user.age_tier.name if user.age_tier else 'Level' }}</div>
                    <div class="stat-label">Your Tier</div>
                </div>
            </div>
        </div>

        <!-- Practice Modes with Contrast Panel -->
        <div style="background: rgba(0, 0, 0, 0.75); padding: 2rem; border-radius: 16px; margin-bottom: 2rem; backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.1);">
        <div class="practice-modes">
            {% if user.tier_id <= 2 %}
                <h3 style="color: white; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); margin: 0 0 1.5rem 0;">üéÆ Choose Your Game!</h3>
            {% elif user.tier_id <= 4 %}
                <h3 style="color: white; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); margin: 0 0 1.5rem 0;">üéØ Practice Modes</h3>
            {% else %}
                <h3 style="color: white; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); margin: 0 0 1.5rem 0;">üìã Training Options</h3>
            {% endif %}
            
            <div class="mode-grid">
                <div class="practice-mode" onclick="startFlashcards()">
                    {% if user.tier_id <= 2 %}
                        <div class="mode-icon">üÉè</div>
                        <h4>Memory Cards</h4>
                        <p>Flip and learn!</p>
                    {% elif user.tier_id <= 4 %}
                        <div class="mode-icon">üìö</div>
                        <h4>Flashcards</h4>
                        <p>Quick review session</p>
                    {% else %}
                        <div class="mode-icon">üìä</div>
                        <h4>Flashcard Review</h4>
                        <p>Systematic vocabulary review</p>
                    {% endif %}
                </div>
                
                <div class="practice-mode" onclick="startQuiz()">
                    {% if user.tier_id <= 2 %}
                        <div class="mode-icon">üß©</div>
                        <h4>Fun Quiz</h4>
                        <p>Answer and win!</p>
                    {% elif user.tier_id <= 4 %}
                        <div class="mode-icon">üéØ</div>
                        <h4>Quiz Mode</h4>
                        <p>Test your knowledge</p>
                    {% else %}
                        <div class="mode-icon">üìù</div>
                        <h4>Assessment Quiz</h4>
                        <p>Comprehensive testing</p>
                    {% endif %}
                </div>
                
                <div class="practice-mode" onclick="startTyping()">
                    {% if user.tier_id <= 2 %}
                        <div class="mode-icon">‚å®Ô∏è</div>
                        <h4>Type Words</h4>
                        <p>Spell it out!</p>
                    {% elif user.tier_id <= 4 %}
                        <div class="mode-icon">‚úçÔ∏è</div>
                        <h4>Spelling Practice</h4>
                        <p>Write the words</p>
                    {% else %}
                        <div class="mode-icon">üìù</div>
                        <h4>Spelling Drill</h4>
                        <p>Advanced spelling practice</p>
                    {% endif %}
                </div>
            </div>
        </div>
        </div>

        <!-- Practice Area with Full Contrast Protection -->
        <div id="practice-area" class="practice-area" style="display: none; background: rgba(0, 0, 0, 0.85) !important; backdrop-filter: blur(12px) !important; border: 2px solid rgba(255, 255, 255, 0.15) !important; border-radius: 16px !important;">
            <div id="practice-content" style="background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); border-radius: 12px; padding: 2rem; margin-bottom: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);"></div>
            <div class="practice-controls" style="background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);">
                <button id="prev-btn" class="btn btn-secondary" onclick="previousWord()" style="background: rgba(108, 117, 125, 0.9) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important;">
                    {% if user.tier_id <= 2 %}‚¨ÖÔ∏è Back{% else %}Previous{% endif %}
                </button>
                <button id="next-btn" class="btn btn-primary" onclick="nextWord()" style="background: rgba(59, 130, 246, 0.9) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important;">
                    {% if user.tier_id <= 2 %}Next ‚û°Ô∏è{% else %}Next{% endif %}
                </button>
                <button id="finish-btn" class="btn btn-success" onclick="finishPractice()" style="display: none; background: rgba(34, 197, 94, 0.9) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important;">
                    {% if user.tier_id <= 2 %}üéâ Done!{% else %}Finish{% endif %}
                </button>
            </div>
        </div>

        <!-- Progress Tracking with Contrast Panel -->
        <div style="background: rgba(0, 0, 0, 0.75); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.1); display: none;" class="practice-progress-panel">
        <div class="practice-progress" style="display: block;">
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
            </div>
            <p class="progress-text" style="color: white; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">
                <span id="current-word">0</span> of <span id="total-words">{{ words|length }}</span>
            </p>
        </div>
        </div>

    {% else %}
        <div class="no-words">
            {% if user.tier_id <= 2 %}
                <div style="font-size: 48px; margin: 20px 0;">üòî</div>
                <h3>Oops! No words to practice yet!</h3>
                <p>Ask your teacher to add some words for you!</p>
            {% elif user.tier_id <= 4 %}
                <h3>No Practice Words Available</h3>
                <p>Contact your administrator to add vocabulary words for your tier.</p>
            {% else %}
                <h3>Vocabulary Database Empty</h3>
                <p>No words are currently available for your tier level. Please contact the administrator.</p>
            {% endif %}
            
            <a href="{{ url_for('learning.dashboard') }}" class="btn btn-primary">
                {% if user.tier_id <= 2 %}üè† Go Home{% else %}Return to Dashboard{% endif %}
            </a>
        </div>
    {% endif %}
    </div>
</div>
</div>

<style>
.practice-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.practice-stats {
    margin: 20px 0;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin: 16px 0;
}

.stat-card {
    background: var(--surface-color);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 20px;
    text-align: center;
}

.stat-number {
    font-size: 32px;
    font-weight: bold;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 14px;
}

.practice-modes {
    margin: 32px 0;
}

.mode-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.practice-mode {
    background: var(--surface-color);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.practice-mode:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    border-color: var(--primary-color);
}

.mode-icon {
    font-size: 48px;
    margin-bottom: 12px;
}

.practice-mode h4 {
    color: var(--primary-color);
    margin: 12px 0 8px 0;
    font-size: 18px;
}

.practice-mode p {
    color: var(--text-secondary);
    margin: 0;
    font-size: 14px;
}

.practice-area {
    background: var(--surface-color);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 40px;
    margin: 24px 0;
    text-align: center;
    min-height: 300px;
}

.practice-controls {
    margin-top: 24px;
    display: flex;
    justify-content: center;
    gap: 12px;
}

.practice-progress {
    margin: 20px 0;
}

.progress-text {
    text-align: center;
    margin-top: 8px;
    font-weight: 600;
}

.no-words {
    text-align: center;
    padding: 60px 20px;
    background: var(--surface-color);
    border-radius: var(--border-radius);
    border: 2px solid var(--border-color);
}

/* Theme-specific adjustments */
.theme-playful .practice-mode {
    transform: rotate(-1deg);
}

.theme-playful .practice-mode:nth-child(2) {
    transform: rotate(1deg);
}

.theme-playful .practice-mode:nth-child(3) {
    transform: rotate(-0.5deg);
}

.theme-playful .practice-mode:hover {
    transform: rotate(0deg) translateY(-6px);
}

.theme-playful .mode-icon {
    animation: bounce-icon 3s ease-in-out infinite;
}

@keyframes bounce-icon {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-8px); }
}

/* Responsive design */
@media (max-width: 768px) {
    .mode-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .practice-controls {
        flex-direction: column;
        align-items: center;
    }
    
    .practice-controls .btn {
        width: 200px;
    }
}
</style>

<script>
// Practice data from Flask
const practiceWords = {{ words|tojson if words else "[]"|safe }};
let currentMode = '';
let currentWordIndex = 0;
let correctAnswers = 0;
let totalAttempts = 0;

function startFlashcards() {
    currentMode = 'flashcards';
    currentWordIndex = 0;
    showPracticeArea();
    showFlashcard();
}

function startQuiz() {
    currentMode = 'quiz';
    currentWordIndex = 0;
    correctAnswers = 0;
    totalAttempts = 0;
    showPracticeArea();
    showQuiz();
}

function startTyping() {
    currentMode = 'typing';
    currentWordIndex = 0;
    correctAnswers = 0;
    totalAttempts = 0;
    showPracticeArea();
    showTyping();
}

function showPracticeArea() {
    document.querySelector('.practice-modes').style.display = 'none';
    document.getElementById('practice-area').style.display = 'block';
    document.querySelector('.practice-progress-panel').style.display = 'block';
    updateProgress();
}

function showFlashcard() {
    const word = practiceWords[currentWordIndex];
    const content = document.getElementById('practice-content');
    
    content.innerHTML = `
        <div class="flashcard" onclick="flipCard()" style="background: rgba(0, 0, 0, 0.8) !important; backdrop-filter: blur(10px) !important; border: 3px solid rgba(255, 255, 255, 0.2) !important; color: white !important;">
            <div class="flashcard-front" style="color: white !important;">
                <h2 style="color: white !important; text-shadow: 0 2px 6px rgba(0, 0, 0, 0.7) !important;">${word.word}</h2>
                <p class="tap-hint" style="color: rgba(255, 255, 255, 0.8) !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7) !important;">{% if user.tier_id <= 2 %}üëÜ Tap to see meaning!{% else %}Click to reveal definition{% endif %}</p>
            </div>
            <div class="flashcard-back" style="display: none; color: white !important;">
                <h3 style="color: white !important; text-shadow: 0 2px 6px rgba(0, 0, 0, 0.7) !important;">${word.word}</h3>
                <p class="definition" style="color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7) !important;">${word.definition}</p>
                <p class="flip-hint" style="color: rgba(255, 255, 255, 0.8) !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7) !important;">{% if user.tier_id <= 2 %}üëÜ Tap to flip back!{% else %}Click to flip back{% endif %}</p>
            </div>
        </div>
    `;
}

function showQuiz() {
    const word = practiceWords[currentWordIndex];
    const content = document.getElementById('practice-content');
    
    // Create multiple choice options (simplified for now)
    const correctDef = word.definition;
    const options = [correctDef];
    
    // Generate pedagogically appropriate distractors from other vocabulary words
    const availableDistractors = practiceWords
        .filter(w => w.word !== word.word) // Exclude current word
        .map(w => w.definition)
        .filter(def => def !== correctDef); // Exclude identical definitions
    
    // Add intelligent distractors based on tier-appropriate pedagogy
    while (options.length < 4 && availableDistractors.length > 0) {
        // Select random distractor and remove it from available pool
        const randomIndex = Math.floor(Math.random() * availableDistractors.length);
        options.push(availableDistractors.splice(randomIndex, 1)[0]);
    }
    
    // Fallback: If not enough vocabulary words, add tier-appropriate distractors
    if (options.length < 4) {
        const tierDistractors = generateTierDistractors(word, {{ session.tier_id or 3 }});
        while (options.length < 4 && tierDistractors.length > 0) {
            options.push(tierDistractors.shift());
        }
    }
    
    // Shuffle options
    for (let i = options.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [options[i], options[j]] = [options[j], options[i]];
    }
    
    content.innerHTML = `
        <div class="quiz-question" style="background: rgba(0, 0, 0, 0.85) !important; backdrop-filter: blur(10px) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; border-radius: 16px !important; padding: 2rem !important;">
            <h2 style="color: white !important; text-shadow: 0 2px 6px rgba(0, 0, 0, 0.7) !important; margin-bottom: 1.5rem !important;">What does "${word.word}" mean?</h2>
            <div class="quiz-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 24px 0;">
                ${options.map((option, index) => `
                    <button class="quiz-option" onclick="selectAnswer('${option}', '${correctDef}')" style="background: rgba(0, 0, 0, 0.8) !important; backdrop-filter: blur(10px) !important; border: 2px solid rgba(255, 255, 255, 0.15) !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important; border-radius: 12px !important; padding: 16px !important; cursor: pointer !important; transition: all 0.2s ease !important;">
                        ${option}
                    </button>
                `).join('')}
            </div>
            <div id="quiz-feedback" class="quiz-feedback" style="color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7) !important; font-weight: bold !important; margin-top: 20px !important; font-size: 18px !important;"></div>
        </div>
    `;
}

function showTyping() {
    const word = practiceWords[currentWordIndex];
    const content = document.getElementById('practice-content');
    
    content.innerHTML = `
        <div class="typing-exercise" style="background: rgba(0, 0, 0, 0.85) !important; backdrop-filter: blur(10px) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; border-radius: 16px !important; padding: 2rem !important; text-align: center !important;">
            <h3 style="color: white !important; text-shadow: 0 2px 6px rgba(0, 0, 0, 0.7) !important; margin-bottom: 1rem !important;">{% if user.tier_id <= 2 %}Type this word:{% else %}Spell the word:{% endif %}</h3>
            <p class="word-definition" style="color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7) !important; font-size: 18px !important; margin-bottom: 1.5rem !important;">${word.definition}</p>
            <input type="text" id="typing-input" class="typing-input" placeholder="{% if user.tier_id <= 2 %}Type here...{% else %}Enter the word...{% endif %}" onkeyup="checkTyping()" style="background: rgba(255, 255, 255, 0.9) !important; border: 2px solid rgba(255, 255, 255, 0.3) !important; color: black !important; padding: 16px !important; border-radius: 12px !important; font-size: 18px !important; text-align: center !important; width: 100% !important; max-width: 400px !important; margin: 16px 0 !important;">
            <div id="typing-feedback" class="typing-feedback" style="color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7) !important; font-weight: bold !important; margin: 16px 0 !important; font-size: 18px !important; min-height: 30px !important;"></div>
            <button id="typing-submit" class="btn btn-primary" onclick="submitTyping()" disabled style="background: rgba(59, 130, 246, 0.9) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important; padding: 12px 24px !important; border-radius: 12px !important; font-size: 16px !important; cursor: pointer !important;">
                {% if user.tier_id <= 2 %}‚úÖ Check!{% else %}Submit{% endif %}
            </button>
        </div>
    `;
}

function flipCard() {
    const front = document.querySelector('.flashcard-front');
    const back = document.querySelector('.flashcard-back');
    
    if (front.style.display !== 'none') {
        front.style.display = 'none';
        back.style.display = 'block';
    } else {
        front.style.display = 'block';
        back.style.display = 'none';
    }
}

function selectAnswer(selected, correct) {
    const feedback = document.getElementById('quiz-feedback');
    const options = document.querySelectorAll('.quiz-option');
    
    options.forEach(option => option.disabled = true);
    
    if (selected === correct) {
        correctAnswers++;
        feedback.innerHTML = `<div class="correct">{% if user.tier_id <= 2 %}üéâ Awesome! That's right!{% else %}‚úÖ Correct!{% endif %}</div>`;
    } else {
        feedback.innerHTML = `<div class="incorrect">{% if user.tier_id <= 2 %}üíô Good try! The answer is: ${correct}{% else %}‚ùå Incorrect. The correct answer is: ${correct}{% endif %}</div>`;
    }
    
    totalAttempts++;
    setTimeout(() => {
        nextWord();
    }, 2000);
}

function checkTyping() {
    const input = document.getElementById('typing-input');
    const submit = document.getElementById('typing-submit');
    
    submit.disabled = input.value.trim().length === 0;
}

function submitTyping() {
    const input = document.getElementById('typing-input');
    const feedback = document.getElementById('typing-feedback');
    const word = practiceWords[currentWordIndex];
    
    const userAnswer = input.value.trim().toLowerCase();
    const correctAnswer = word.word.toLowerCase();
    
    if (userAnswer === correctAnswer) {
        correctAnswers++;
        feedback.innerHTML = `<div class="correct">{% if user.tier_id <= 2 %}üåü Perfect spelling!{% else %}‚úÖ Correct spelling!{% endif %}</div>`;
    } else {
        feedback.innerHTML = `<div class="incorrect">{% if user.tier_id <= 2 %}üíô Good try! The word is: ${word.word}{% else %}‚ùå Incorrect. The correct spelling is: ${word.word}{% endif %}</div>`;
    }
    
    totalAttempts++;
    setTimeout(() => {
        nextWord();
    }, 2000);
}

function previousWord() {
    if (currentWordIndex > 0) {
        currentWordIndex--;
        updateContent();
        updateProgress();
    }
}

function nextWord() {
    if (currentWordIndex < practiceWords.length - 1) {
        currentWordIndex++;
        updateContent();
        updateProgress();
    } else {
        finishPractice();
    }
}

function updateContent() {
    if (currentMode === 'flashcards') {
        showFlashcard();
    } else if (currentMode === 'quiz') {
        showQuiz();
    } else if (currentMode === 'typing') {
        showTyping();
    }
}

function updateProgress() {
    const progress = ((currentWordIndex + 1) / practiceWords.length) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    document.getElementById('current-word').textContent = currentWordIndex + 1;
    document.getElementById('total-words').textContent = practiceWords.length;
    
    // Show/hide navigation buttons
    document.getElementById('prev-btn').style.display = currentWordIndex > 0 ? 'inline-block' : 'none';
    document.getElementById('next-btn').style.display = currentWordIndex < practiceWords.length - 1 ? 'inline-block' : 'none';
    document.getElementById('finish-btn').style.display = currentWordIndex === practiceWords.length - 1 ? 'inline-block' : 'none';
}

function finishPractice() {
    const content = document.getElementById('practice-content');
    let resultMessage = '';
    
    if (currentMode === 'flashcards') {
        resultMessage = `{% if user.tier_id <= 2 %}üéâ Great job! You reviewed ${practiceWords.length} words!{% else %}Practice complete! You reviewed ${practiceWords.length} words.{% endif %}`;
    } else {
        const percentage = Math.round((correctAnswers / totalAttempts) * 100);
        if (percentage >= 80) {
            resultMessage = `{% if user.tier_id <= 2 %}üåü Amazing! You got ${correctAnswers} out of ${totalAttempts} right!{% else %}Excellent! Score: ${correctAnswers}/${totalAttempts} (${percentage}%){% endif %}`;
        } else if (percentage >= 60) {
            resultMessage = `{% if user.tier_id <= 2 %}üëç Good work! You got ${correctAnswers} out of ${totalAttempts} right!{% else %}Good effort! Score: ${correctAnswers}/${totalAttempts} (${percentage}%){% endif %}`;
        } else {
            resultMessage = `{% if user.tier_id <= 2 %}üíô Keep practicing! You got ${correctAnswers} out of ${totalAttempts} right!{% else %}Keep practicing! Score: ${correctAnswers}/${totalAttempts} (${percentage}%){% endif %}`;
        }
    }
    
    content.innerHTML = `
        <div class="practice-complete" style="background: rgba(0, 0, 0, 0.85) !important; backdrop-filter: blur(10px) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; border-radius: 16px !important; padding: 2rem !important; text-align: center !important;">
            <h2 style="color: white !important; text-shadow: 0 2px 6px rgba(0, 0, 0, 0.7) !important; margin-bottom: 1.5rem !important;">${resultMessage}</h2>
            <div class="completion-actions" style="margin-top: 24px; display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="location.reload()" style="background: rgba(59, 130, 246, 0.9) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important; padding: 12px 24px !important; border-radius: 12px !important; cursor: pointer !important;">
                    {% if user.tier_id <= 2 %}üîÑ Practice Again{% else %}Practice Again{% endif %}
                </button>
                <a href="{{ url_for('learning.dashboard') }}" class="btn btn-secondary" style="background: rgba(108, 117, 125, 0.9) !important; border: 2px solid rgba(255, 255, 255, 0.2) !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important; padding: 12px 24px !important; border-radius: 12px !important; text-decoration: none !important;">
                    {% if user.tier_id <= 2 %}üè† Go Home{% else %}Return to Dashboard{% endif %}
                </a>
            </div>
        </div>
    `;
    
    document.querySelector('.practice-controls').style.display = 'none';
}

// Generate age-appropriate distractor definitions when vocabulary pool is insufficient
function generateTierDistractors(word, tierLevel) {
    // Tier-specific distractor patterns based on pedagogical research
    const tierDistractors = {
        1: [ // Early Verbal (Ages 2-4): Simple opposites and common confusions
            "Very cold", "Very small", "Goes down", "White food", 
            "Not hot", "Very quiet", "Yellow drink", "Square toy"
        ],
        2: [ // Preschool (Ages 4-6): Category mixing and semantic neighbors  
            "Feeling sad and crying", "Animal with stripes", "Color of the sky",
            "Something you eat for breakfast", "Place where you sleep", "Sound that animals make"
        ],
        3: [ // Elementary (Ages 6-10): Academic concepts and grade-level vocabulary
            "A mathematical operation", "Part of a plant that grows underground",
            "Tool used for writing", "Subject studied in school", "Type of weather condition"
        ],
        4: [ // Middle School (Ages 11-14): Abstract concepts and discipline mixing
            "Scientific process involving chemicals", "Historical event from ancient times",
            "Literary device used in poetry", "Geographic feature found in mountains"
        ],
        5: [ // High School (Ages 15-18): Advanced academic terminology
            "Philosophical concept about existence", "Advanced mathematical theorem",
            "Biological process in cellular metabolism", "Sociological theory about human behavior"
        ],
        6: [ // Adult (18+): Professional and sophisticated vocabulary
            "Complex economic principle", "Advanced psychological construct", 
            "Specialized technical methodology", "Nuanced cultural phenomenon"
        ]
    };
    
    // Return shuffled distractors for the appropriate tier
    const distractors = [...(tierDistractors[tierLevel] || tierDistractors[3])];
    return distractors.sort(() => Math.random() - 0.5);
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    if (practiceWords.length === 0) {
        document.querySelector('.practice-modes').style.display = 'none';
    }
});
</script>

<style>
.flashcard {
    background: var(--background-color);
    border: 3px solid var(--primary-color);
    border-radius: 12px;
    padding: 40px;
    cursor: pointer;
    transition: transform 0.3s ease;
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

.flashcard:hover {
    transform: scale(1.02);
}

.flashcard h2, .flashcard h3 {
    color: var(--primary-color);
    margin-bottom: 16px;
    font-size: 32px;
}

.definition {
    font-size: 18px;
    color: var(--text-primary);
    margin-bottom: 16px;
}

.tap-hint, .flip-hint {
    color: var(--text-secondary);
    font-style: italic;
    font-size: 14px;
}

.quiz-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 24px 0;
}

.quiz-option {
    background: var(--surface-color);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 16px;
}

.quiz-option:hover {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: white;
}

.quiz-feedback {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
}

.correct {
    color: var(--success-color);
}

.incorrect {
    color: var(--error-color);
}

.typing-input {
    width: 100%;
    max-width: 400px;
    padding: 16px;
    font-size: 18px;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    margin: 16px 0;
    text-align: center;
}

.typing-input:focus {
    outline: none;
    border-color: var(--primary-color);
}

.typing-feedback {
    margin: 16px 0;
    font-size: 18px;
    font-weight: bold;
    min-height: 30px;
}

.practice-complete {
    text-align: center;
    padding: 40px;
}

.completion-actions {
    margin-top: 24px;
    display: flex;
    gap: 16px;
    justify-content: center;
}

/* Theme-specific styling for playful mode */
.theme-playful .flashcard {
    border-radius: 20px;
    border-width: 4px;
    animation: gentle-pulse 3s ease-in-out infinite;
}

@keyframes gentle-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.theme-playful .quiz-option {
    border-radius: 16px;
    border-width: 3px;
}

/* CRITICAL: iOS Safari Text Readability Fixes */
.quiz-option {
    background: rgba(0, 0, 0, 0.8) !important;
    backdrop-filter: blur(10px) !important;
    border: 2px solid rgba(255, 255, 255, 0.15) !important;
    color: white !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important;
}

.quiz-option:hover, .quiz-option:active, .quiz-option:focus {
    background: rgba(59, 130, 246, 0.9) !important;
    border-color: rgba(255, 255, 255, 0.3) !important;
    color: white !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7) !important;
}

/* Mobile-specific overrides for iOS */
@media (max-width: 768px) {
    .quiz-options {
        grid-template-columns: 1fr;
    }
    
    .completion-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .completion-actions .btn {
        width: 200px;
    }
    
    /* iOS Safari specific fixes */
    .quiz-option {
        -webkit-appearance: none !important;
        -webkit-tap-highlight-color: transparent !important;
        background: rgba(0, 0, 0, 0.9) !important;
        backdrop-filter: blur(15px) !important;
        color: white !important;
        text-shadow: 0 3px 6px rgba(0, 0, 0, 0.8) !important;
        font-size: 16px !important;
        min-height: 60px !important;
    }
    
    .quiz-option:active {
        background: rgba(59, 130, 246, 0.95) !important;
        transform: scale(0.98) !important;
    }
}
</style>
{% endblock %}